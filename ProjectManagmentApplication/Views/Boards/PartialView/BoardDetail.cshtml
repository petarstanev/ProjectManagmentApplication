@using ProjectManagementApplication.Models
@model Board


    @foreach (var column in Model.Columns)
    {
        <div id="column_@column.ColumnId" class="col-md-2 board-column">
            <h3 class="text-center">
                @Html.ActionLink(column.Title, "Edit", "Columns", new { id = column.ColumnId }, null)
            </h3>
            @foreach (var task in column.Tasks)
            {
                <div id="task_@task.TaskId" class="well task-container">
                    <div class="task-header">
                        @Html.ActionLink(task.Title, "Details", "Tasks", new { id = task.TaskId }, null)
                    </div>
                    <div class="task-content">
                        @task.Description
                    </div>
                </div>
            }
        </div>
    }


<script type="text/javascript">
    $(document).ready(function () {
        var hub = $.connection.boardHub;
        $.connection.hub.start().done(function () {
            $(".board-column")
                .sortable({
                    connectWith: ".board-column",
                    cancel: ".add-column-btn",
                    start: function (event, ui) {
                        ui.item.addClass('task-moving');
                    },
                    stop: function (event, ui) {
                        ui.item.removeClass("task-moving");
                    },
                    receive: function (event, ui) {
                        var taskId = ui.item[0].id.replace(/^\D+/g, '');//get id number from id
                        var columnId = this.id.replace(/^\D+/g, '');
                        $.ajax({
                            url: '/Tasks/ChangeTaskColumn',
                            type: "POST",
                            data: { taskId: taskId, columnId: columnId },
                            statusCode: {
                                400: function (data) {
                                    console.log('Opps an error occurred.');
                                },
                                200: function (data) {
                                    var boardId = $("#board-id").val();
                                    hub.server.boardUpdated(boardId);

                                    console.log("send");
                                }
                            }
                        });
                    }
                });
        });
    });
</script>